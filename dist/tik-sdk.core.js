!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@sentry/browser")):"function"==typeof define&&define.amd?define(["@sentry/browser"],t):"object"==typeof exports?exports.core=t(require("@sentry/browser")):(e.tikSDK=e.tikSDK||{},e.tikSDK.core=t(e.Sentry))}(this,(function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){var r,i,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(1),n(5),n(2)],void 0===(s="function"==typeof(r=function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}Object.defineProperty(e,"__esModule",{value:!0}),e.base_domain=a,e.base_url=u,e.default=e.session=void 0,t=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}(t),n=i(n),r=i(r);const o={authToken:null,instructorAuthToken:null};function a(){return r.default.API_BASE_URL}function u(){return a()+r.default.API_PREFIX}e.session=o;var l=class{constructor(){this.lookup_field="id",this.useCache={list:!1,get:!1},this.validateCache=!0}get base_domain(){return a()}get base_url(){return u()}configCache(e,t){this.useCache=e,this._cacheTimeout&&clearInterval(this._cacheTimeout),t&&(this.cacheTimeout=t,this._cacheTimeout=setInterval(()=>{this.validateCache=!0},this.cacheTimeout))}async http(e,r,i,s=!1){r=r?`${this.resource}/${r}`:""+this.resource;let a={};if(i)if(Object.values(i).some(e=>e instanceof File)){const e=new FormData;for(let[t,n]of Object.entries(i))null===n&&(n=""),e.append(t,n);i=e}else i=JSON.stringify(i),a={"Content-Type":"application/json; charset=utf-8"};else i=void 0;console.log(e,r,i||"");let u,l=`${this.base_url}${r}/`;i&&"GET"===e&&(l+=n.default.stringify(i,!0),i=null);try{if(o.authToken&&(a.Authorization="Bearer "+o.authToken),u=await fetch(l,{method:e,headers:a,body:i,mode:"cors",cache:"no-cache",redirect:"follow",referrer:"no-referrer"}),!(u.ok||s&&[404,401].includes(u.status))){const e=new Error(u.statusText||u.status);throw e.response=u,e}if("DELETE"!==e)return await u.json()}catch(e){throw console.error("HTTP Error:",l.toString(),JSON.stringify(i),u&&u.status),console.log("Sentry",typeof t,t,Object.keys(t)),"object"==typeof t&&"captureException"in t&&t.captureException(e),e}}toObj(e){return e}async list(){if(this.useCache.list&&!this.validateCache&&this.data)console.log(`[HTTP] ${this.resource}.list(): using cache`);else{const e=await this.http("GET","");this.data=e,this.validateCache=!1}return this.data}async get(e,t=!1){if(e){const n=await this.http("GET",e,null,t);return this.toObj(n)}return this.new()}async save(e,t,n=!1,r=!1,i=!1){if(this.validateCache=!0,!e.id&&!t||n)return await this.http("POST","",e,i);{const n=await this.http(r?"PATCH":"PUT",t||e.id,e,i);return this.toObj(n)}}new(){return null}async delete(e){return this.validateCache=!0,this.http("DELETE",e)}};e.default=l})?r.apply(t,i):r)||(e.exports=s)},function(t,n){t.exports=e},function(e,t,n){var r,i,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(6)],void 0===(s="function"==typeof(r=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setConfigValue=function(e,t){r[e]=t},e.setConfig=function(e){for(const t of Object.keys(n))t in e&&(r[t]=e[t])},e.default=void 0;const n={API_BASE_URL:"",API_PREFIX:"/api/",CACHE_PREFIX:"",VERSION:t.version,PROTOCOL:"https"},r=Object.assign({},n);var i=r;e.default=i})?r.apply(t,i):r)||(e.exports=s)},function(e,t,n){var r,i,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(4),n(10)],void 0===(s="function"==typeof(r=function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"auth",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"users",{enumerable:!0,get:function(){return n.default}}),t=r(t),n=r(n)})?r.apply(t,i):r)||(e.exports=s)},function(e,t,n){var r,i,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(1),n(0),n(7),n(8)],void 0===(s="function"==typeof(r=function(e,t,n,r,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}function a(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=r?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.AuthApi=void 0,t=a(t),n=a(n),r=s(r),i=s(i);class u extends n.default{constructor(){super(),this.resource="token",this.me={},this.ns={me:"me",token:"token",authToken:"authToken"}}async fetchMe(){return await r.default.me()}async currentUser(){if(this.me&&this.me.id)return this.me;{let e;if(i.default.has(this.ns.me)&&(e=i.default.get(this.ns.me)),navigator.onLine)try{e=await this.fetchMe()}catch(e){}return e?(i.default.set(this.ns.me,e),this.me=e,t.configureScope(e=>{e.setUser({id:this.me.email})}),this.me):(await this.logout(),null)}}async login(e,t){const r=await this.http("POST","",{email:e,password:t},!0);return!!r.access&&(n.session[this.ns.authToken]=r.access,i.default.set(this.ns.token,{token:r.access}),!0)}async isLoggedin(){const e=i.default.get(this.ns.token);if(e){let t=!0;if(navigator.onLine&&(t=await this.http("POST","verify",e,!0),t=t&&"token_not_valid"!==t.code),t)return n.session[this.ns.authToken]=e.token,console.log(n.session),!0}return i.default.del(this.ns.token),!1}async logout(){this.me={},n.session[this.ns.authToken]=null,i.default.del(this.ns.token),i.default.del(this.ns.me),t.configureScope(e=>{e.setUser({})})}}e.AuthApi=u;var l=new u;e.default=l})?r.apply(t,i):r)||(e.exports=s)},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty;function i(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function s(e){try{return encodeURIComponent(e)}catch(e){return null}}t.stringify=function(e,t){t=t||"";var n,i,o=[];for(i in"string"!=typeof t&&(t="?"),e)if(r.call(e,i)){if((n=e[i])||null!=n&&!isNaN(n)||(n=""),i=s(i),n=s(n),null===i||null===n)continue;o.push(i+"="+n)}return o.length?t+o.join("&"):""},t.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,r={};t=n.exec(e);){var s=i(t[1]),o=i(t[2]);null===s||null===o||s in r||(r[s]=o)}return r}},function(e){e.exports=JSON.parse('{"name":"tik-sdk","version":"2020.09.09","main":"dist/tik-sdk.full.js","module":"index.js","browser":"dist/tik-sdk.full.js","types":"types/tik-sdk.full.d.ts","description":"TIK SDK","author":{"name":"TIK (Technology Innovation Network)","email":"contact@tik.tn","url":"https://tik.tn"},"homepage":"https://tik.tn","private":true,"scripts":{"test":"jest","build:webpack":"webpack","build:babel":"babel index.js -d lib","lint":"eslint --ext .js,.vue,.ts --ignore-path .gitignore --ignore-pattern **/*.min.js ."},"browserslist":["last 2 versions","not IE 11","not IE_Mob 11","not dead"],"dependencies":{"@sentry/browser":"^5.5.0","@sentry/integrations":"^5.5.0","querystringify":"^2.1.1"},"devDependencies":{"@babel/cli":"^7.11.6","@babel/core":"^7.11.6","@babel/plugin-transform-modules-umd":"^7.10.4","@babel/preset-env":"^7.11.5","babel-eslint":"^10.0.1","babel-jest":"^26.3.0","clean-webpack-plugin":"^3.0.0","eslint":"^7.2.0","eslint-config-prettier":"^6.0.0","eslint-config-standard":">=12.0.0","eslint-loader":"^4.0.2","eslint-plugin-import":">=2.16.0","eslint-plugin-jest":">=24.0.0","eslint-plugin-node":">=8.0.1","eslint-plugin-prettier":"^3.0.1","eslint-plugin-promise":">=4.0.1","eslint-plugin-standard":">=4.0.0","husky":"^4.0.1","jest":"^26.4.2","lint-staged":"^10.3.0","nodemon":"^2.0.4","prettier":"^2.0.5","stylelint":"^13.1.0","ts-loader":"^8.0.3","typescript":"^4.0.2","webpack":"^4.44.1","babel-loader":"^8.1.0","webpack-cli":"^3.3.12"}}')},function(e,t,n){var r,i,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(0)],void 0===(s="function"==typeof(r=function(e,t){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(n=t)&&n.__esModule?n:{default:n};class r extends t.default{constructor(){super(),this.resource="staffs",this.configCache({list:!0},36e5)}new(){return{full_name:"",status:"indoor",roles:["commercial"],phone:"",email:"",attrs:{unlimited_access:!1,start_at:"08:00",end_at:"18:00"},is_active:!0}}async me(){const e=await this.http("GET","me",null,!0);return this.toObj(e)}toObj(e){return e.roles=["admin","manager","finance","suivi","commercial","stock","freelance"].filter(t=>e.roles.includes(t)),Object.defineProperties(e,{role:{get(){return this.roles[0]}},is_admin:{get(){return this.roles.includes("admin")}},is_freelance:{get(){return this.roles.includes("freelance")}},start_at:{value:"08:00",writable:!1},end_at:{value:"18:00",writable:!1},unlimited_access:{get(){return this.attrs.unlimited_access},set(e){this.attrs.unlimited_access=e}}}),e}async unlimited(){return this.http("GET","unlimited")}roles(){return["admin","manager","finance","suivi","commercial","stock",...process.env.MODULES.includes("pos")&&["pos"]||[]]}}var i=new r;e.default=i})?r.apply(t,i):r)||(e.exports=s)},function(e,t,n){(function(r){var i,s,o,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,a=function(e,t){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.Cache=void 0,t=(n=t)&&n.__esModule?n:{default:n};class i{has(e){return r.localStorage&&r.localStorage[`${t.default.CACHE_PREFIX}_cache_${e}`]}del(e){r.localStorage&&delete r.localStorage[`${t.default.CACHE_PREFIX}_cache_${e}`]}get(e,n=!0){if(n&&this.has(e))try{return JSON.parse(r.localStorage[`${t.default.CACHE_PREFIX}_cache_${e}`])}catch(e){}}set(e,n){if(r.localStorage){const i=`${t.default.CACHE_PREFIX}_cache_${e}`;r.localStorage[i]=JSON.stringify(n)}}async withCache(e,t,n=!1){const r=this.get(e,n);if(r)return r;const i=await t();return this.set(e,i),i}async fallbackCache(e,t,n=!1){let r;if(n)return this.get(e,!0);try{r=await t(),this.set(e,r)}catch(t){if("Forbidden"===t.message)throw t;r=this.get(e,!0)}return r}}e.Cache=i;var s=new i;e.default=s},s=[t,n(2)],void 0===(o="function"==typeof(i=a)?i.apply(t,s):i)||(e.exports=o)}).call(this,n(9))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r,i,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(0)],void 0===(s="function"==typeof(r=function(e,t){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.UsersApi=void 0,t=(n=t)&&n.__esModule?n:{default:n};class r extends t.default{constructor(){super(),this.resource="users",this.configCache({list:!0},36e5)}async me(){return await this.http("GET","me",null,!0)}async activate(e,t){return await this.http("POST",e+"/activate",{token:t},!0)}async get_by_email(e){return await this.http("POST","email",{email:e},!0)}}e.UsersApi=r;var i=new r;e.default=i})?r.apply(t,i):r)||(e.exports=s)}])}));
//# sourceMappingURL=tik-sdk.core.js.map